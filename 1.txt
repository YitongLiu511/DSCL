一、数据预处理与嵌入
时空分块嵌入
首先对交通信号数据进行时间因果卷积和分块处理，将时间序列划分为非重叠的块（patch），减少计算复杂度并增强模型对长期依赖的捕捉能力。例如，将时间长度为 
T的数据划分为 T/P个块（
P为块长度），通过线性投影和位置编码生成潜在嵌入表示 
P，保留时空顺序信息。
二、动态全局上下文流（捕捉时空动态依赖）
该流通过时空自注意力机制和对比软聚类，学习区域间的复杂时空交互和空间异质性。

时间自注意力块
对每个节点的分块嵌入进行多头自注意力计算，捕捉时间维度上的长程依赖。通过查询矩阵 
Q
、键矩阵 
K
 和值矩阵 
V
 的缩放点积操作，生成时间注意力输出 
O 
(n)
 
，并通过残差连接和层归一化优化特征表示。
*对比软聚类*
生成 
K
 个聚类中心，通过计算节点嵌入与聚类中心的内积 
S
，引入对比异质性损失 
L 
hetero，迫使模型学习不同区域的功能语义差异（如住宅区与商业区的流量模式差异），增强对异常模式的区分能力。
空间自注意力块
对每个时间块的节点嵌入进行空间自注意力计算，捕捉空间维度上的全局依赖。通过空间注意力矩阵 
A 
D
​
 
 表征动态时空依赖，用于后续对比损失计算。
三、静态服务流（建模预期服务与流量的关系）
该流通过多视图图卷积网络（GCN）和时间注意力，学习交通流量与区域预期服务水平的静态关联。

多视图图卷积
基于距离、连通性、POI 相似性等多视图邻接矩阵 
A 
k
​
 
，通过高斯核计算自适应空间关系 
A
^
  
k
​
 
，并利用图卷积提取各视图下的静态依赖特征。例如，对第 
k
 个视图，通过 
Z
^
  
t
​
 = 
A
^
  
k
​
 f( 
A
^
  
k
​
 Z 
t
​
 W 
k
(1)
​
 )W 
k
(2)
​
 
 生成视图特定的嵌入。
多视图融合与时间注意力
融合多视图特征得到静态时空依赖矩阵 
A 
S
​
 
，并通过门控机制融合动态与静态流的特征，最终重构原始交通信号 
X
^
 
，用于计算重构损失。
四、联合损失函数与异常评分
通过三种损失函数的联合优化，量化动态与静态流的不匹配，识别异常区域。

重构损失（
L 
recon
​
 
）
衡量原始信号 
X
 与重构信号 
X
^
 
 的差异，公式为 
L 
recon
​
 = 
N
1
​
 ∑ 
n=1
N
​
 ∥X 
(n)
 − 
X
^
  
(n)
 ∥ 
2
2
​
 
，异常区域的重构误差较高。
双流对比损失（
L 
dual
​
 
）
基于 KL 散度计算动态依赖 
A 
D
​
 
 与静态依赖 
A 
S
​
 
 的分布差异，包括 
L 
D
​
 
 和 
L 
S
​
 
 两个方向的对比，迫使正常区域的动态与静态模式一致，异常区域则产生显著差异。
对比异质性损失（
L 
hetero
​
 
）
辅助聚类优化，确保模型区分不同功能区域的流量模式，增强空间异质性感知。
异常评分
综合重构误差和对比损失，每个节点的异常评分为：
Score(v 
n
​
 )=∥X 
(n)
 − 
X
^
  
(n)
 ∥ 
2
2
​
 +β⋅sysKL(A 
D
​
 (n),A 
S
​
 (n))

当评分超过阈值 
ϵ
 时，判定为异常区域。